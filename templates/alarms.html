{% extends "base.html" %}
{% block content %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold">‚è∞ Study Alarms</h2>
        <a href="{{ url_for('main.dashboard') }}" class="btn btn-outline-primary btn-sm">Dashboard</a>
    </div>

    <div class="card p-4 mb-4 shadow-sm border-0">
        <form method="POST" class="row g-3">
            <div class="col-md-5"><input type="text" name="label" class="form-control" placeholder="Label" required></div>
            <div class="col-md-4"><input type="time" name="time" class="form-control" required></div>
            <div class="col-md-3"><button type="submit" class="btn btn-danger w-100">Set Alarm</button></div>
        </form>
    </div>

    <div class="row">
        {% for alarm in alarms %}
        <div class="col-md-4 mb-3">
            <div class="card shadow-sm border-start border-danger border-5 p-3 alarm-card" data-time="{{ alarm.time }}">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="mb-0">{{ alarm.label }}</h5>
                        <p class="text-danger fw-bold mb-0">{{ alarm.time }}</p>
                    </div>
                    <a href="{{ url_for('main.delete_alarm', id=alarm.id) }}" class="btn btn-sm btn-outline-secondary">Delete</a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<audio id="alarm-audio" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" preload="auto"></audio>

<script>
    function checkAlarms() {
        const now = new Date();
        const currentTime = now.getHours().toString().padStart(2, '0') + ":" + 
                            now.getMinutes().toString().padStart(2, '0');
        
        document.querySelectorAll('.alarm-card').forEach(card => {
            if (card.getAttribute('data-time') === currentTime) {
                document.getElementById('alarm-audio').play();
                card.classList.add('bg-warning');
            }
        });
    }
    setInterval(checkAlarms, 10000);
</script>
{% endblock %}